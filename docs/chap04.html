<!DOCTYPE html>
<html lang="en"><head>
<script src="chap04_files/libs/clipboard/clipboard.min.js"></script>
<script src="chap04_files/libs/quarto-html/tabby.min.js"></script>
<script src="chap04_files/libs/quarto-html/popper.min.js"></script>
<script src="chap04_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="chap04_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="chap04_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="chap04_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="chap04_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.552">

  <title>chap04</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="chap04_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="chap04_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="chap04_files/libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="lecture-theme.css">
  <link href="chap04_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="chap04_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="chap04_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="chap04_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">


<section class="slide level0">

<h1><span class="header-section-number">4</span> 双曲型偏微分方程式の解法 (2)：非線形問題</h1>
<p><span class="math display">\[
\newcommand{\bm}[1]{\symbfit{#1}}
\]</span></p>
</section>
<section class="slide level0">

<h4 id="参考文献">参考文献</h4>
<ul>
<li>藤井孝蔵. (1994). 流体力学の数値計算法. 東京大学出版会.</li>
<li>LeVeque, R. J. (1990). Numerical Methods for Conservation Laws. Numerical Methods for Conservation Laws. Basel: Springer Berlin Heidelberg. https://doi.org/10.1007/978-3-0348-5116-9</li>
<li>Laney, C. B. (1998). Computational Gasdynamics. Cambridge University Press. https://doi.org/10.1017/CBO9780511605604</li>
<li>Toro, E. F. (2009). Riemann Solvers and Numerical Methods for Fluid Dynamics. Riemann Solvers and Numerical Methods for Fluid Dynamics: A Practical Introduction. Berlin, Heidelberg: Springer Berlin Heidelberg. https://doi.org/10.1007/b79761</li>
</ul>
</section>
<section class="slide level0">

<h2><span class="header-section-number">4.1</span> Burgers方程式</h2>
<div class="column-body">
<div class="column-page" width="800" height="600">
<div class="absolute" style="top: 0px; right: 50px; height: 32px; ">
<p><a href="https://colab.research.google.com/github/amanotk/numerical-geophysics/blob/main/notebook/BurgersEquation.ipynb" target="_blank"><img data-src="figure/colab-badge.svg"></a></p>
</div>
</div>
</div>
<p>非線形の偏微分方程式として以下のBurgers方程式を考えよう． <span class="math display">\[
\frac{\partial u}{\partial t} + u \frac{\partial u}{\partial x} =
\alpha \frac{\partial^2 u}{\partial x^2}
\]</span> ここで<span class="math inline">\(\alpha\)</span>は粘性項（拡散項）であり，<span class="math inline">\(\alpha = 0\)</span>であればこの方程式は双曲型偏微分方程式に分類される．線形移流方程式と異なり移流速度が<span class="math inline">\(u\)</span>に依存する形になっている．例えば流体力学における音波の位相速度は振幅に依存し，有限振幅の音波は有限時間で衝撃波に発展する．Burgers方程式はこれを簡単化したものと考えることができる．</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figure/steepening.png" height="380"></p>
<figcaption>Ref: Burgess &amp; Scholer (Collisionless Shocks in Space Plasmas)</figcaption>
</figure>
</div>
</section>
<section class="slide level0">

<h3 id="特性曲線">特性曲線</h3>
<p>一般に <span class="math display">\[
\frac{\partial u}{\partial t} + \lambda (u) \frac{\partial u}{\partial x} = 0
\]</span> と書けるとき，<span class="math inline">\(\lambda(u)\)</span>を特性速度と呼ぶ．特性速度によって定義される <span class="math display">\[
\frac{d x}{d t} = \lambda(u)
\]</span> を特性曲線と呼ぶ．特性曲線に沿って物理量<span class="math inline">\(u\)</span>が保存することは簡単に示すことができる．特性曲線に沿って一定となる量は特性量やRiemann不変量などと呼ばれる． 線形移流方程式では<span class="math inline">\(\lambda(u) = c\)</span>で一定であるため，異なる特性曲線が交わることはない．一方でBurgers方程式では<span class="math inline">\(\lambda(u) = u\)</span>であるため，一般には有限時間で異なる特性曲線が交わることになる．このとき数学的に一意な解が存在しない．数学的には有限の粘性<span class="math inline">\(\alpha \neq 0\)</span>があれば，それが局所的に散逸として働き不連続な<strong>衝撃波</strong>が形成する．</p>
<h4 id="q.4-1">Q.4-1</h4>
<p>特性曲線に沿った物理量<span class="math inline">\(u\)</span>の微分をとることによって，特性曲線に沿って<span class="math inline">\(u\)</span>が保存することを示せ． <span class="math display">\[
\frac{d}{d t} = \frac{\partial}{\partial t} +
\frac{d x}{d t} \frac{\partial}{\partial x}
\]</span> を用いればよい．</p>
</section>
<section class="slide level0">

<h3 id="衝撃波解">衝撃波解</h3>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figure/burgers-shock.png" height="600"></p>
<figcaption>Ref: Toro (2009)</figcaption>
</figure>
</div>
</section>
<section class="slide level0">

<p>初期条件 <span class="math display">\[
u(x, t=0) =
\begin{cases}
u_{L} \quad x &lt; 0 \\
u_{R} \quad x &gt; 0
\end{cases}
\]</span> が与えられたとき，積分形式 <span class="math display">\[
\int_{x_1}^{x_2} dx
\left(
  \frac{\partial u}{\partial t} + \frac{\partial f(u)}{\partial x}
\right) = 0
\]</span> を考えると衝撃波の伝播速度<span class="math inline">\(S\)</span>は以下の式で与えられる． <span class="math display">\[
S = \frac{f(u_{R}) - f(u_{L})}{u_{R} - u_{L}}
\]</span> 非粘性のBurgers方程式(<span class="math inline">\(\alpha = 0\)</span>, <span class="math inline">\(f(u) = u^2/2\)</span>)について考えると，<span class="math inline">\(S = (u_{\rm R} + u_{\rm L})/2\)</span>となることがすぐに分かる．</p>
<p>このように微分方程式の解のうち，滑らかな領域で微分形を満足し，不連続な領域も含めて至るところで積分形を満足する解を弱解（weak solution）と呼ぶ．</p>
<h4 id="q.4-2">Q.4-2</h4>
<p>上記の積分形式において<span class="math inline">\(x_1 &lt; x &lt; St\)</span>では<span class="math inline">\(u = u_{L}\)</span>, <span class="math inline">\(St &lt; x &lt; x_2\)</span>では<span class="math inline">\(u = u_{R}\)</span>であることを用いて，衝撃波の伝播速度<span class="math inline">\(S\)</span>を求めよ．ただし積分区間<span class="math inline">\([x_1, x_2]\)</span>は（この区間に衝撃波を含むよう十分大きくとれば）任意である．</p>
</section>
<section class="slide level0">

<h3 id="膨張波解">膨張波解</h3>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figure/burgers-rarefaction.png" height="600"></p>
<figcaption>Ref: Toro (2009)</figcaption>
</figure>
</div>
</section>
<section class="slide level0">

<h3 id="膨張衝撃波解">膨張衝撃波解</h3>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figure/burgers-expansion-shock.png" height="600"></p>
<figcaption>Ref: Toro (2009)</figcaption>
</figure>
</div>
</section>
<section class="slide level0">

<h3 id="エントロピー条件">エントロピー条件</h3>
<ul>
<li><p>一般に非線形双曲型偏微分方程式の弱解は一意には定まらないため，可能な複数の数値解から物理的に妥当な解を選択しなければならない．例えば流体力学の場合には熱力学第2法則からエントロピーが増大することが要請され，これから膨張衝撃波解は物理的に棄却される．</p></li>
<li><p>数学的な意味でのBurgers方程式には「エントロピー」は存在しないが，便宜的に「エントロピー」を導入することで膨張衝撃波解を棄却し，解の一意性を担保することができる．</p></li>
<li><p>詳細な議論は適当な教科書に譲るとして，直感的には不連続な弱解があるとき， <strong>特性線が不連続に収束する</strong> （不連続から特性線が湧き出さない）ことをエントロピー条件として考えればよい．Burgers方程式やEuler方程式を始めとするconvexな流束関数(<span class="math inline">\(f'(u) &gt; 0\)</span>)について考えると，これは以下のように表すことができる． <span class="math display">\[
  f'(u_{R}) \leq S \leq f'(u_{L})
\]</span> 具体的にBurgers方程式の場合には <span class="math display">\[
  u_{R} \leq S \leq u_{L}
\]</span> がエントロピー条件となる．膨張衝撃波はこれを満たさないことは明らかである．</p></li>
<li><p><strong>Lax-Wendroffの定理</strong>：保存形の数値計算スキームを考えるとき，数値解が収束するならば，元の微分方程式の弱解に収束する． ただし（膨張衝撃波も弱解の1つなので）収束する解が物理的な解とは限らず，エントロピー条件を満たす物理的な解に収束するようなスキームを選択する必要がある． いずれにしても，非保存形のスキームは一般に衝撃波速度を正しく与えないので，衝撃波（やそれに類する不連続面）が重要になる問題では保存形スキームがほぼ必須となっている．</p></li>
</ul>
</section>
<section class="slide level0">

<h3 id="次精度風上差分法">1次精度風上差分法</h3>
<p>簡単のため<span class="math inline">\(u &gt; 0\)</span>および<span class="math inline">\(\alpha = 0\)</span>を仮定しよう．このとき風上差分でも以下の3通りが考えられる． <span class="math display">\[
\begin{align}
\frac{u^{n+1}_{i} - u^{n}_{i}}{\Delta t} &amp;+
\frac{u^{n}_{i} + u^{n}_{i-1}}{2} \frac{u^{n}_{i} - u^{n}_{i-1}}{\Delta x}
= 0 \tag{A} \\
\frac{u^{n+1}_{i} - u^{n}_{i}}{\Delta t} &amp;+
u^{n}_{i} \frac{u^{n}_{i} - u^{n}_{i-1}}{\Delta x}
= 0 \tag{B} \\
\frac{u^{n+1}_{i} - u^{n}_{i}}{\Delta t} &amp;+
u^{n}_{i-1} \frac{u^{n}_{i} - u^{n}_{i-1}}{\Delta x}
= 0 \tag{C} \\
\end{align}
\]</span></p>
<p>スキーム(A)は <span class="math display">\[
\frac{u^{n+1}_{i} - u^{n}_{i}}{\Delta t} +
\frac{\hat{f}_{i+1/2} - \hat{f}_{i-1/2}}{\Delta x} = 0
\]</span> のように保存形に書き直すことができる．ここで <span class="math display">\[
\hat{f}_{i+1/2} = \frac{(u^{n}_{i})^2}{2}
\]</span> が数値流速である．一方でスキーム(B)(C)は保存形で書くことはできない．</p>
</section>
<section class="slide level0">

<p><img data-src="figure/burgers-upwind.png" height="500"></p>
<ul>
<li>(A): 衝撃波も膨張波も正しく捉えられている．</li>
<li>(B): 衝撃波が動いていない</li>
<li>(C): 衝撃波速度が正しくない．膨張波もできていない．</li>
</ul>
</section>
<section class="slide level0">

<h3 id="滑らかな初期条件の場合">滑らかな初期条件の場合</h3>
<p>2段階Lax-Wendroffスキームは非線形問題にも適用できるようにオリジナルのLax-Wendroffスキームを改良したものである．実際にこれを用いて粘性あり（<span class="math inline">\(\alpha \neq 0\)</span>）のBurgers方程式を解いてみよう．具体的には <span class="math display">\[
\begin{aligned}
&amp; u_{i+1/2} = \frac{u_{i} + u_{i+1}}{2} - \frac{\Delta t}{2 \Delta x}
\left( f_{i+1} - f_{i} \right)
\\
&amp; \hat{f}_{i+1/2} = \frac{(u_{i+1/2})^2}{2} -
\kappa_{i+1/2} \frac{\Delta x}{\Delta t} (u_{i+1} - u_{i}) -
\alpha \frac{u_{i+1} - u_{i}}{\Delta x}
\end{aligned}
\]</span> のように求めた数値流速を用いて解を更新すればよい． ここで <span class="math display">\[
\kappa_{i+1/2} = \varepsilon |u_{i+1} - u_{i}|
\]</span> とし，定数<span class="math inline">\(\varepsilon \sim 0.1\)</span>で人工粘性の強さをコントロールする．</p>
</section>
<section class="slide level0">

<h3 id="数値解">数値解</h3>
<p><img data-src="figure/burgers-steepening.png" height="600"></p>
</section>
<section class="slide level0">

<h2><span class="header-section-number">4.2</span> Euler方程式</h2>
<div class="column-body">
<div class="column-page" width="800" height="600">
<div class="absolute" style="top: 0px; right: 50px; height: 32px; ">
<p><a href="https://colab.research.google.com/github/amanotk/numerical-geophysics/blob/main/notebook/EulerEquation.ipynb" target="_blank"><img data-src="figure/colab-badge.svg"></a></p>
</div>
</div>
</div>
<p>Euler方程式（圧縮性流体力学の支配方程式）は質量・運動量・エネルギー保存則から次のように書き表される． <span class="math display">\[
\frac{\partial}{\partial t}
\begin{pmatrix}
\rho \\
\rho v \\
\varepsilon
\end{pmatrix} +
\frac{\partial}{\partial x}
\begin{pmatrix}
\rho v \\
\rho v^2 + p \\
(\varepsilon + p) v
\end{pmatrix} = 0
\tag{4.2.1} \label{eq:euler}
\]</span> ここで <span class="math display">\[
\varepsilon = \frac{1}{2} \rho v^2 + \frac{p}{\gamma-1}
\]</span> は流体の全エネルギー密度，<span class="math inline">\(\gamma\)</span>は比熱比である．</p>
<p>式(<span class="math inline">\(\ref{eq:euler}\)</span>)は非線形連立双曲型保存則(System of Nonlinear Hyperbolic Conservation Laws)の実用的に重要な例の一つである．ここで<span class="math inline">\(\bm{u} = (\rho, \rho v, \varepsilon)\)</span>の方程式はそれぞれ質量保存則，運動量保存則，エネルギー保存則を表す．</p>
</section>
<section class="slide level0">

<h4 id="q.4-3">Q.4-3</h4>
<p>一様で静止した流体を平衡状態とし，これに対する微小摂動を考えることにより音波の分散関係<span class="math inline">\(\omega^2 = k^2 C_s^2\)</span>が得られることを示せ．ただし，<span class="math inline">\(C_s = \sqrt{\gamma p_0/\rho_0}\)</span>は音速である．</p>
<h4 id="q.4-4">Q.4-4</h4>
<p>Euler方程式のエネルギー保存則を書き換えると断熱の条件（流体素片の運動に沿ってエントロピーが一定） <span class="math display">\[
\frac{d}{dt} \left( \frac{p}{\rho^{\gamma}} \right) = 0
\]</span> が得られる．このことを示せ．</p>
<h4 id="q.4-5">Q.4-5</h4>
<p>Euler方程式の固有モードには，音波以外にエントロピー波と呼ばれるモードが存在する．これは密度は非一様で圧力が一定（すなわちエントロピーが非一様）の構造が流体に流されているものと考えることができる．具体的に<span class="math inline">\(v = v_0 = const\)</span>, <span class="math inline">\(p = p_0 = const\)</span>の条件のとき， <span class="math display">\[
\frac{d}{dt} \rho = 0
\]</span> であればEuler方程式が満たされることを示せ．</p>
</section>
<section class="slide level0">

<h3 id="有限振幅の音波">有限振幅の音波</h3>
<p>簡単のためエントロピー<span class="math inline">\(S = p/\rho^\gamma\)</span>が一定と仮定しよう．Euler方程式を書き直すと以下の2式が得られる． <span class="math display">\[
\begin{aligned}
&amp; \frac{\partial \rho}{\partial t}
+ \rho \frac{\partial v}{\partial x}
+ v \frac{\partial \rho}{\partial x} = 0,
\\
&amp; \frac{\partial v}{\partial t}
+ v \frac{\partial v}{\partial x}
+ \frac{C_s^2}{\rho} \frac{\partial \rho}{\partial x} = 0.
\end{aligned}
\]</span> ここで<span class="math inline">\(C_s^2 = \gamma p/\rho \propto \rho^{\gamma-1}\)</span>は定数でないことに注意．さらに<span class="math inline">\(\rho\)</span>を<span class="math inline">\(C_s\)</span>で書き換えると <span class="math display">\[
%\begin{aligned}
\frac{\partial}{\partial t}
\left(
    v \pm \frac{2 C_s}{\gamma-1}
\right) +
\left( v \pm C_s \right)
\frac{\partial}{\partial x}
\left(
    v \pm \frac{2 C_s}{\gamma-1}
\right)
= 0, \tag{4.2.2} \label{eq:riemann-invariant}
%\end{aligned}
\]</span> となり，<span class="math inline">\(J_{\pm} = v \pm 2 C_s/(\gamma-1)\)</span>が以下で定義される特性曲線に沿って一定となる（すなわちRiemann不変量である）ことが分かる． <span class="math display">\[
\frac{dx}{dt} = \lambda_{\pm} = v \pm C_s.
\]</span></p>
<h4 id="q.4-6">Q.4-6</h4>
<p>式(<span class="math inline">\(\ref{eq:riemann-invariant}\)</span>)を示せ．</p>
</section>
<section class="slide level0">

<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figure/characteristics.png" height="500"></p>
<figcaption>Ref: Laney (1998)</figcaption>
</figure>
</div>
<ul>
<li>変数の個数の分だけ特性曲線および対応する不変量が存在する．</li>
<li>異なる不変量に関する特性曲線は互いに交わる．</li>
<li>微分方程式の解の一意性のため，一つの不変量に関する特性曲線は交わることはない．交わる場合は衝撃波（不連続面）が存在しなければならない．</li>
</ul>
</section>
<section class="slide level0">

<h3 id="音波の伝播と急峻化">音波の伝播と急峻化</h3>
<p><img data-src="figure/soundwave1.png" class="absolute" style="top: 80px; left: 40px; width: 600px; "> <img data-src="figure/soundwave2.png" class="absolute" style="top: 80px; left: 680px; width: 600px; "></p>
</section>
<section class="slide level0">

<h2><span class="header-section-number">4.3</span> Riemann問題</h2>
<h4 id="sodの衝撃波管問題">Sodの衝撃波管問題</h4>
<p><img data-src="figure/sodproblem.png" height="500"></p>
</section>
<section class="slide level0">

<p>一般に保存則 <span class="math display">\[
\frac{\partial \bm{u}}{\partial t} +
\frac{\partial \bm{f}(\bm{u})}{\partial x} = 0
\]</span> において初期条件 <span class="math display">\[
\bm{u}(x, t=0) =
\begin{cases}
\bm{u}_{L} \quad x &lt; 0 \\
\bm{u}_{R} \quad x &gt; 0
\end{cases}
\]</span> が与えられたときの時間発展を求める問題をRiemann問題と呼ぶ．このとき固有値の数（すなわち変数の数）の分だけ<span class="math inline">\(x = 0\)</span>から「波」が発生する．この「波」の影響がおよぶ領域をRiemann fanと呼ぶ．</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figure/riemann.png" height="300"></p>
<figcaption>Ref: Toro (2009)</figcaption>
</figure>
</div>
</section>
<section class="slide level0">

<p>保存則を変形して <span class="math display">\[
\begin{aligned}
\frac{\partial \bm{u}}{\partial t} +
\frac{\partial \bm{f}(\bm{u})}{\partial x} = 0
\rightarrow
\frac{\partial \bm{u}}{\partial t} +
\frac{\partial \bm{f}}{\partial \bm{u}} \cdot \frac{\partial \bm{u}}{\partial x} =
\frac{\partial \bm{u}}{\partial t} +
\bm{A} \cdot \frac{\partial \bm{u}}{\partial x} =
0
\end{aligned}
\]</span> と書いておこう．ここで<span class="math inline">\(A_{ij} = \partial f_{i}/\partial u_{j}\)</span>はこの系のJacobianである．このJacobianの固有値<span class="math inline">\(\lambda_{i}\)</span>および固有ベクトル<span class="math inline">\(\bm{r}_{i}\)</span>を <span class="math display">\[
\bm{A} \bm{r}_{i} = \lambda_{i} \bm{r}_{i}
\quad (i=1, 2, \ldots, n)
\]</span> によって定義する．固有ベクトルを並べた行列<span class="math inline">\(\bm{R} = (\bm{r}_1, \bm{r}_2, \ldots, \bm{r}_{n})\)</span>を用いると，Jacobianを対角化できる． <span class="math display">\[
\bm{\Lambda} = \bm{R}^{-1} \bm{A} \bm{R} =
\text{diag} (\lambda_1, \lambda_2, \ldots, \lambda_n)
\]</span> さらに変数変換<span class="math inline">\(d \bm{v} \equiv \bm{R}^{-1} d \bm{u}\)</span>を用いると，元の方程式は<span class="math inline">\(n\)</span>個の独立な線形移流方程式 <span class="math display">\[
\frac{\partial v_{i}}{\partial t} +
\lambda_{i}
\frac{\partial v_{i}}{\partial x} = 0
\]</span> に書き直すことができる．ここで固有値<span class="math inline">\(\lambda_i\)</span>は<span class="math inline">\(v_i\)</span>の伝播速度（特性速度）を表しており，明らかに<span class="math inline">\(v_i\)</span>は特性量（Riemann不変量）である．</p>
<h4 id="section"></h4>
<ul>
<li>実際にはEuler方程式は非線形なので<span class="math inline">\(\lambda_i\)</span>も<span class="math inline">\(\bm{u}\)</span>の関数であるが，定性的な性質は変わらない．</li>
<li>一般に独立変数が<span class="math inline">\(n\)</span>個ある方程式系では固有値・固有ベクトル（すなわち波動モードの数）も<span class="math inline">\(n\)</span>個ある．全ての固有値（<span class="math inline">\(\lambda_i\)</span>）が実数の方程式系は双曲型保存則と呼ばれる．</li>
</ul>
</section>
<section class="slide level0">

<h3 id="応用例1">応用例1</h3>
<p><img src="figure/cir.png" width="400px" style="position: absolute; left: 150px; top: 20px"></p>
<p><img src="figure/cas-a-chandra.jpg" width="400px" style="position: absolute; left: 150px; top: 380px"></p>
<p><img src="figure/heliosphere.gif" width="400px" style="position: absolute; left: 650px; top: 20px"></p>
<p><img src="figure/pwn_xray.png" width="300px" style="position: absolute; left: 700px; top: 380px"></p>
</section>
<section class="slide level0">

<h3 id="応用例2">応用例2</h3>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figure/piecewise-linear.png" height="300"></p>
<figcaption>Ref: Laney (1998)</figcaption>
</figure>
</div>
<p>圧縮性流体力学では一般に不連続な解が発生するため，セル境界における解の連続性を要請しないスキームが好まれる．セル境界での数値流束<span class="math inline">\(\hat{\bm{f}}_{i+1/2}\)</span>が決められれば <span class="math display">\[
\frac{\bm{u}^{n+1}_{i} - \bm{u}^{n}_{i}}{\Delta t} +
\frac{\hat{\bm{f}}_{i+1/2} - \hat{\bm{f}}_{i-1/2}}{\Delta x} = 0
\]</span> から解を更新することができる．ここで各セル境界においてRiemann問題の近似解を使って数値流束を決定するのが一般的な手法である．（Riemann問題の完全な解が必要なわけではなく，あくまでセル境界における数値流束だけが必要なことに注意．）</p>
</section>
<section class="slide level0">

<h2><span class="header-section-number">4.4</span> 線形化されたRiemann解法</h2>
<h3 id="線形riemann問題">線形Riemann問題</h3>
<p>線形Riemann問題ではJacobian<span class="math inline">\(\bm{A}\)</span>が<span class="math inline">\(\bm{u}\)</span>に依存しない．したがって，対角化の結果は時間・空間によらず常に同じ結果となる．特性量に書き換えたRiemann問題は <span class="math display">\[
\bm{v}(x, t=0) =
\begin{cases}
\bm{v}_{L} = \bm{R}^{-1} \bm{u}_{L} \quad x &lt; 0
\\
\bm{v}_{R} = \bm{R}^{-1} \bm{u}_{R} \quad x &gt; 0
\end{cases}
\]</span> となる．各特性量に関する線形移流方程式は互いに独立なので，線形Riemann問題の解はトリビアルに決まる．例えば独立変数の数が<span class="math inline">\(n = 3\)</span>のときの解は下図の通り．</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figure/linear-riemann-problem.png" height="300"></p>
<figcaption>Ref: Laney (1998)</figcaption>
</figure>
</div>
</section>
<section class="slide level0">

<h4 id="q.4-7">Q.4-7</h4>
<p>簡単な例として線形化されたEuler方程式 <span class="math display">\[
\begin{aligned}
&amp; \frac{\partial \rho}{\partial t} +
\rho_0 \frac{\partial v}{\partial x} = 0,
\\
&amp; \frac{\partial v}{\partial t} +
\frac{C_s^2}{\rho_0} \frac{\partial \rho}{\partial x} = 0
\end{aligned}
\]</span> を考えよう．このときのJacobianおよび固有値，固有ベクトルは以下の通りである． <span class="math display">\[
\begin{aligned}
A =
\begin{pmatrix} 0 &amp; \rho \\ C_s^2/\rho &amp; 0 \end{pmatrix}
\end{aligned}
\quad
\rightarrow
\quad
\lambda_{\pm} = \pm C_s,
\bm{r}_{\pm} =
\begin{pmatrix}
\rho \\ \mp C_s
\end{pmatrix}
\]</span> これらを用いると，初期の左状態を<span class="math inline">\((\rho_L, v_L)\)</span>，右状態を<span class="math inline">\((\rho_R, v_R)\)</span>とするRiemann問題の解が <span class="math display">\[
(\rho, v) =
\begin{cases}
(\rho_L, v_L) \quad &amp; x &lt; -C_s t \\
\displaystyle
\left(
\frac{\rho_L + \rho_R}{2} + \frac{\rho_0}{C_s} \frac{v_L - v_R}{2},
\frac{v_L + v_R}{2} + \frac{C_s}{\rho_0} \frac{\rho_L - \rho_R}{2},
\right)   &amp; -C_s t &lt; x &lt; +C_s t \\
(\rho_R, v_R) \quad &amp; +C_s t &lt; x
\end{cases}
\]</span> で与えられることを示せ．</p>
</section>
<section class="slide level0">

<h3 id="非線形問題への適用roe法">非線形問題への適用（Roe法）</h3>
<p>一般に非線形問題ではJacobianが<span class="math inline">\(\bm{u}\)</span>に依存するが，セル境界で局所的にJacobianを一定だと仮定すると，問題は局所的には線形になる．したがって，線形Riemann問題の解を使って数値流束を <span class="math display">\[
\hat{\bm{f}} =
\frac{1}{2} \left( \bm{f}(\bm{u}_R) + \bm{f}(\bm{u}_L) \right) -
\frac{1}{2} |\bm{A}| \left( \bm{u}_{R} - \bm{u}_L \right)
\]</span> のように評価することができる．ただし <span class="math display">\[
|\bm{A}| = \bm{R} |\bm{\Lambda}| \bm{R}^{-1} \quad
|\bm{\Lambda}| \equiv \text{diag} (|\lambda_1|, |\lambda_2|, \ldots, |\lambda_n|)
\]</span> である．（証明は難しくはないが，長くなるのでここでは省略．） 数値流束の第1項は右状態と左状態のフラックスの単純な平均値，第2項は拡散項として働く．したがって，<span class="math inline">\(|\bm{A}|\)</span>はしばしば散逸行列（dissipation matrix）などと呼ばれる．</p>
<p>明らかに<span class="math inline">\(|\bm{A}|\)</span>は不連続面の右状態と左状態に依存する：<span class="math inline">\(|\bm{A}| = |\bm{A}(\bm{u}_L, \bm{u}_R)|\)</span>．ここでRoe平均と呼ばれる右状態と左状態のある種の平均を用いると良い結果が得られることが知られている．この手法は一般に<strong>Roe法</strong>と呼ばれている．宇宙流体業界では一斉を風靡した手法である（らしい）．</p>
<p>※ Roe法では非物理的な膨張衝撃波が生じることがあり，回避するためにエントロピー補正を導入する必要がある．</p>
</section>
<section class="slide level0">

<h3 id="burgers方程式への適用">Burgers方程式への適用</h3>
<p>Burgers方程式において，右状態と左状態の単純な算術平均で <span class="math display">\[
\lvert \bm{A}(\bm{u}_L, \bm{u}_R) \rvert \rightarrow
\left| \frac{\partial f}{\partial u} \right| =
\left| \frac{u_{R} + u_{L}}{2} \right|
\]</span> のようにJacobianを評価すれば，数値流束は以下のように評価できる． <span class="math display">\[
\hat{f} = \frac{1}{2}
\left[
  \left( f_{R} + f_{L} \right) -
  \frac{ \left| u_{R} + u_{L} \right| }{2}
  \left( u_{R} - u_{L} \right)
\right]
\]</span> ここで，各セル内で<span class="math inline">\(u\)</span>が一定と仮定すると <span class="math display">\[
\hat{f}_{i+1/2} =
\begin{cases}
  \dfrac{\left( u_{i} \right)^2}{2}
  &amp; \left( \dfrac{\partial f}{\partial u} &gt; 0 \right) \\
  \dfrac{\left( u_{i+1} \right)^2}{2}
  &amp; \left( \dfrac{\partial f}{\partial u} &lt; 0 \right) \\
\end{cases}
\]</span> となり，このスキームが保存形の一次精度風上差分法「スキーム（A）」に一致することが分かる．</p>
</section>
<section class="slide level0">

<h2><span class="header-section-number">4.5</span> HLL型Riemann解法</h2>
<h3 id="hll法">HLL法</h3>
<p>HLL（Harten-Lax-van Leer）法はRiemann fanの内部で物理量が一定だと仮定する．何らかの方法で最大固有値<span class="math inline">\(\lambda_{\rm max} = S_R\)</span>および最小固有値<span class="math inline">\(\lambda_{\rm min} = S_L\)</span>が求まれば，Riemann fanが定義される．</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figure/hll-riemann-solver.png" height="300"></p>
<figcaption>Ref: Toro (2009)</figcaption>
</figure>
</div>
<p>基礎方程式を<span class="math inline">\([0, t] \times [S_L t, S_R t]\)</span>で積分すると，Riemann fan内部の物理量<span class="math inline">\(\bm{u}_{*}\)</span>は <span class="math display">\[
\bm{u}_{*} = \frac{1}{S_R - S_L}
\left[
  S_R \bm{u}_R - S_L \bm{u}_L + \bm{f}_L - \bm{f}_R
\right]
\]</span> と求まる．これはHLL平均などと呼ばれる．</p>
</section>
<section class="slide level0">

<p>同様に基礎方程式を<span class="math inline">\([0, t] \times [0, S_R t]\)</span>で積分し，<span class="math inline">\(\bm{u}_{*}\)</span>を代入すると数値流束は <span class="math display">\[
\hat{\bm{f}}^{\rm HLL} =
\begin{cases}
\bm{f}_L &amp; 0 \leq S_L
\\
\displaystyle
\frac{1}{S_R - S_L}
\left[
  S_R \bm{f}_L - S_L \bm{f}_R + S_L S_R \left( \bm{u}_R - \bm{u}_L \right)
\right]
&amp; S_L \leq 0 \leq S_R
\\
\bm{f}_R &amp; S_R \leq 0
\end{cases}
\]</span> から求まる．（<span class="math inline">\([0, t] \times [S_L t, 0]\)</span>で積分しても同じ結果が得られる．）</p>
<p><span class="math inline">\(S_L = \min(0, S_L)\)</span>, <span class="math inline">\(S_R = \max(0, S_R)\)</span>と読み替えれば数値流束は常に <span class="math display">\[
\hat{\bm{f}}^{\rm HLL} =
\frac{1}{S_R - S_L}
\left[
  S_R \bm{f}_L - S_L \bm{f}_R + S_L S_R \left( \bm{u}_R - \bm{u}_L \right)
\right]
\tag{*}
\]</span> で与えられる．これがHLL法の数値流束である．流束の重み付き平均に散逸項<span class="math inline">\(\bm{u}_R - \bm{u}_L\)</span>が付加されていることが分かる．</p>
<h4 id="q.4-8">Q.4-8</h4>
<p>HLL法の数値流束が<span class="math inline">\((*)\)</span>で与えられることを示せ．</p>
</section>
<section class="slide level0">

<ul>
<li><p>HLL法は固有値の最大値および最小値さえ求まれば方程式系によらない．固有値分解が必要ないのは大きな利点である．最大・最小固有値だけであれば比較的簡単に求まるが，固有値分解は解析的にも面倒だし数値的にも計算コストがかかる．例えばEuler方程式であれば最大・最小固有値は<span class="math inline">\(\lambda_{\rm max/min} = v \pm C_s\)</span>である．</p></li>
<li><p>Riemann fanが左右対称，すなわち<span class="math inline">\(c \equiv S_R = -S_L\)</span>と書けるとする．これを代入すると <span class="math display">\[
\hat{\bm{f}}^{\rm LLF} =
\frac{1}{2}
\left[
\bm{f}_L + \bm{f}_R - c \left( \bm{u}_R - \bm{u}_L \right)
\right]
\tag{*}
\]</span> これはRusanov法(local Lax-Friedrichs法）などとも呼ばれる．HLL法よりも散逸を強く取り入れている（すなわちより安定になっている）ことに注意しよう．</p></li>
<li><p>Riemann fanの内部構造を無視しているため，中間固有値に対応するモード（Euler方程式で言えばエントロピーモード）を解像できない．散逸項が最大・最小固有値によって決まることを考えると，特に中間固有値と最大・最小固有値の差が大きいときには数値的な散逸を過度に取り入れてしまう．</p></li>
</ul>
</section>
<section class="slide level0">

<h3 id="hllc法-euler方程式">HLLC法 (Euler方程式)</h3>
<p>HLL法のRiemann fan内部で物理量が一定という仮定をやめて，内部構造を考えてみよう．一般にはRiemann fanの内部構造は方程式系に依存するので，どんな保存則にも使えるというHLL法の利点は失われてしまうが，それによって解像度が向上するのであれば一考の価値はあるだろう．ここでは下図のようにEuler方程式について中間固有値（エントロピーモード）を1つ考え，Riemann fan内部を2状態で近似してみよう．エントロピーモードに対応する不連続は接触不連続面(Contact Discontinuity)なので，この2状態近似のRimeann解法は名前に”C”をつけてHLLC法と呼ばれる．</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figure/hllc-riemann-solver.png" height="300"></p>
<figcaption>Ref: Toro (2009)</figcaption>
</figure>
</div>
</section>
<section class="slide level0">

<p>まずRiemann fan全体で積分をし，HLL平均<span class="math inline">\(\bm{u}_{*}\)</span>の定義を用いると，以下の関係式を得る． <span class="math display">\[
\frac{S_* - S_L}{S_R - S_L} \bm{u}_{*L} +
\frac{S_R - S_*}{S_R - S_L} \bm{u}_{*R} = \bm{u}_{*} \tag{A}
\]</span></p>
<p>さらにRiemann fanの一部で同じように積分すると <span class="math display">\[
\begin{align}
&amp; \bm{f}_{*L} = \bm{f}_L + S_L (\bm{u}_{*L} - \bm{u}_L) \tag{B}
\\
&amp; \bm{f}_{*R} = \bm{f}_R + S_R (\bm{u}_{*R} - \bm{u}_R) \tag{C}
\end{align}
\]</span></p>
<p>したがって，<span class="math inline">\(S_{*}, \bm{u}_{*L}, \bm{u}_{*R}\)</span>が与えられれば，数値流速は以下のように求まる．</p>
<p><span class="math display">\[
\hat{\bm{f}}^{\rm HLLC} =
\begin{cases}
\bm{f}_{L} &amp; 0 \leq S_L
\\
\bm{f}_{*L} &amp; S_L \leq 0 \leq S_*
\\
\bm{f}_{*R} &amp; S_* \leq 0 \leq S_R
\\
\bm{f}_R &amp; S_R \leq 0
\end{cases}
\]</span></p>
<h4 id="q.4-9">Q.4-9</h4>
<p>上記の式(A)，(B)，(C)を示せ．</p>
</section>
<section class="slide level0">

<p>Riemann fanの内部状態（<span class="math inline">\(S_{*}, \bm{u}_{*L}, \bm{u}_{*R}\)</span>）を求めるにはいくつか仮定が必要になる．これにはいくつかの流儀があるが，ここでは最も簡単な例を考えよう． まずは(B)および(C)式の質量および運動量保存の成分について具体的に考えると <span class="math display">\[
p_{*L} = p_L + \rho_L (S_L - v_L)(v_{*L} - v_L), \quad
p_{*R} = p_R + \rho_R (S_R - v_R)(v_{*R} - v_R)
\]</span> を得る．ここで中間固有値がエントロピーモードであることを考えると，接触不連続面の性質から<span class="math inline">\(v_{*L} = v_{*R} = S_*\)</span>, <span class="math inline">\(p_{*L} = p_{*R}\)</span>としてよいだろう．</p>
<p>ここでEuler方程式の具体的な形を使って少し計算すると，中間状態<span class="math inline">\(K = L, R\)</span>について <span class="math display">\[
\bm{u}_{*K} = \frac{S_K \bm{u}_K - \bm{f}_K + p_{*K} \bm{D}_*}{S_K - S_*}
\]</span> とコンパクトに書けることが分かる．ただしここで<span class="math inline">\(\bm{D}_{*} = (0, 1, S_*)\)</span>である．これを使って数値流速を書き直すと <span class="math display">\[
\bm{f}_{*K} =
\frac{
  S_* \left( S_K \bm{u}_K - \bm{f}_K \right) - S_K p_{*K} \bm{D}_{*}
}{
  S_K - S_*
}
\]</span> となる．</p>
</section>
<section class="slide level0">

<h3 id="様々なhll型riemann解法mhd方程式の場合">様々なHLL型Riemann解法（MHD方程式の場合）</h3>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figure/hll-family.png" height="500"></p>
<figcaption>Ref: Miyoshi &amp; Kusano (2007)</figcaption>
</figure>
</div>
<ul>
<li>内部構造の近似の仕方によって様々な種類が存在する．</li>
<li>最も簡単なHLL法以外は一般に方程式系に陽に依存する．</li>
<li>より正確に内部構造を考慮するRiemann解法は解像度は高いが，数値的に不安定になりやすい．</li>
</ul>
<div class="quarto-auto-generated-content">
<div class="footer footer-default">
<p>地球物理数値解析（天野孝伸）</p>
</div>
</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="chap04_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="chap04_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="chap04_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="chap04_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="chap04_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="chap04_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="chap04_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="chap04_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="chap04_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="chap04_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,

        height: 720,

        // Factor of the display size that should remain empty around the content
        margin: 5.0e-2,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>